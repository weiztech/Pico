{% extends 'base_lit_reviews.html' %}
{% block 'head' %}
{% load static %}
<link href="{% static 'css/theme/articles_list.css' %}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block 'help_section' %} 
  <a 
    href="https://citemed-io.gitbook.io/citemed.io-documentation/abstract-reviewing/the-1st-pass-abstract-review-screen"
    target="_blank"
  >
    <span>Need help with this page? <br/> Read the Wiki</span>
    <div>
      <img src="{% static 'images/icons/wiki-icon.svg' %}">
    </div>   
</a>

{% endblock %} 

{% block 'body' %}
  <div id="app" v-cloak> 
    
    {% if max_hits %}
      <div v-if="selectedStates.includes('U')">
          <div v-if="pagination.count > {{max_hits}}">
            <toast 
              id="max-results-warning" 
              ref="max-results-warning"
              ref=""
              title="Max Results Exceeded" 
              type="warning" 
              :hidden="false"
            >
              <div>
                  The max articles that should be reviewed in this project are {{max_hits}}, 
                  but you currently have [[pagination.count]] which is exceeding the maximum please contact 
                  PM to discuss this before you start 1st pass screening.
                  <br>
                  Still stuck? Get instant help from our team by submitting a ticket <a href="https://share.hsforms.com/1jqB4CJx9RxyvGL3qQYo2rgcq0hk" target=”_blank”> HERE.</a>
              </div>
              <button class="secondary-gray-button mt" v-on:click="hideToast('max-results-warning')"> Ok, I Understand </button>
            </toast>
          </div>
      </div>
    {% endif %}

    <div v-if="sharedState.prismaStatus === 'RUNNING'">
        <toast 
          id="prisma-deduplication-warning" 
          ref="prisma-deduplication-warning"
          ref=""
          title="Deduplication is running" 
          type="warning" 
          :hidden="false"
        >
          <div style="font-size: 16; width: 400px;">
            Deduplication is still running, please don't start your review until it's completed. This process can take a few minutes,
            you can also check the prisma status on the bottom of the page.
          </div>
        </toast>
    </div>

    <div class="form-content">
      <div class="section-header">
        <h3 class="center-v">
          [[ isUnclassified ? 'Unclassified' : 'All Citations' ]]
          {% comment %} <div class="tooltip-elt" :title="isUnclassified ? 'Articles waiting for review' : 'Imported Articles List'">
            <img src="{% static 'images/icons/tooltip.svg' %}" alt="" srcset="">
          </div> {% endcomment %}
          <page-wiki-helper wiki-link="https://citemed-io.gitbook.io/citemed.io-documentation/abstract-reviewing/the-1st-pass-abstract-review-screen"> </page-wiki-helper>
        </h3>
        <div>
          <page-switcher
            first-page-label="Table View"
            second-page-label="Board View"
            first-page-link="#"
            second-page-link="#"
            :active-page="viewType"
            :switch-call-back="onSwitchView"
          >
          </page-switcher>
        </div>
        <div class="center-v">
          <span class="mr"> Total Articles </span>
          <span class="badge badge-squared secondary"> <strong> [[pagination.count]] </strong> </span>
        </div>
      </div>

      <div class="horizantal-devider"> </div>
      <div class="content"> 

        <div class="filters">
          <div class="search-section">
            <form v-on:submit="onSearch">
              <input 
                type="search" 
                placeholder="Search For Articles by Title, Abstract ...etc" 
                name="article-search" 
                v-model="searchTerm"
              />
              <button type="submit" class="search-button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0625 3.125C5.78331 3.125 3.125 5.78331 3.125 9.0625C3.125 12.3417 5.78331 15 9.0625 15C12.3417 15 15 12.3417 15 9.0625C15 5.78331 12.3417 3.125 9.0625 3.125ZM1.875 9.0625C1.875 5.09295 5.09295 1.875 9.0625 1.875C13.032 1.875 16.25 5.09295 16.25 9.0625C16.25 13.032 13.032 16.25 9.0625 16.25C5.09295 16.25 1.875 13.032 1.875 9.0625Z" fill="#9BA5B9"/>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M13.2611 13.2612C13.5051 13.0171 13.9009 13.0171 14.1449 13.2612L17.9418 17.0581C18.1859 17.3022 18.1859 17.6979 17.9418 17.942C17.6977 18.1861 17.302 18.1861 17.0579 17.942L13.2611 14.1451C13.017 13.901 13.017 13.5053 13.2611 13.2612Z" fill="#9BA5B9"/>
                </svg>
              </button>
            </form>
          </div>

          <div class="filter-button ml" v-on:click="showModal('filters-slider')">
            <div class="filter-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.59993 1.40002H12.3999C13.1333 1.40002 13.7333 2.00002 13.7333 2.73336V4.20002C13.7333 4.73336 13.3999 5.40002 13.0666 5.73336L10.1999 8.26669C9.79993 8.60002 9.53327 9.26669 9.53327 9.80002V12.6667C9.53327 13.0667 9.2666 13.6 8.93327 13.8L7.99994 14.4C7.13327 14.9334 5.93327 14.3334 5.93327 13.2667V9.73336C5.93327 9.26669 5.6666 8.66669 5.39994 8.33336L2.8666 5.66669C2.53327 5.33336 2.2666 4.73336 2.2666 4.33336V2.80002C2.2666 2.00002 2.8666 1.40002 3.59993 1.40002Z" stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg v-if="isFiltersApplied" class="filter-applied" xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6"
                fill="none">
                <circle cx="3" cy="3" r="2.5" fill="#F7154B" stroke="white" />
              </svg>
            </div>
            Filter Results
          </div>

          <div class="field-sorting">
            <div class="filter-button ml" v-on:click="onToggleSortingDropDown">
              <img src="{% static 'images/icons/arrow-3.svg' %}" alt="sort icon" />
              Sort
            </div>
  
            <div class="sort-dropdown" ref="sorting-dropdown">
              <custom-select
                id="sort"
                name="sort"
                :options="sortOptions"
                :on-change="onSortingChange"
                :default-selected="appliedSort"
              >
              </custom-select>
              <div class="mt mb"> </div>
              <custom-select
                id="sort-direction"
                name="sort-direction"
                :options="sortingDirectionOptions"
                :on-change="onSortingDirectionChange"
                :default-selected="sortingDirection"
              >
              </custom-select>
              <div class="center-v mt-2">
                <button v-on:click="onToggleSortingDropDown" class="secondary-gray-button ml-auto small-button"> Cancel </button>
                <button v-on:click="onSort" class="primary-button ml small-button"> Apply </button>
              </div>
            </div>
          </div>

          {% if SHOW_AI_BETA %}
            <button 
              style="display: flex;"
              class="primary-button ml" 
              @click="onGenerateAISuggestions"
              :disabled="isArchived || isAISuggestionsLoading"
              :class="{ loading: isAISuggestionsLoading }" 
            >
              <div class="center-v"> 
                <img 
                  class="header-right-icon mr" 
                  style="width: 15px;" 
                  src="{% static 'images/icons/ai-white.png' %}" alt="show-pdf-file-icon" srcset=""
                />
                <span>
                  Generate AI Suggestions
                </span>
              </div>
            </button>
          {% endif %}

          <button 
            class="secondary-gray-button ml" 
            @click="onShowAISuggestions"
          >
            <div class="center-v"> 
              <img 
                v-if="isShowAISuggestions"
                class="header-right-icon mr" 
                style="width: 15px;" 
                src="{% static 'images/icons/eye-closed-icon.svg' %}"                 
                alt="show-pdf-file-icon"
              />
              <img 
                v-else
                class="header-right-icon mr" 
                style="width: 15px;" 
                src="{% static 'images/icons/eye-open-icon.svg' %}" 
                alt="show-pdf-file-icon"
              />
              <span>
                [[ isShowAISuggestions ? 'Hide' : 'Show' ]] AI Suggestions
              </span>
            </div>
          </button>

          <div class="ml-auto"> </div>
          
          <!-- State Applied Filters -->
          <div v-if="!isUnclassified">
            <div class="applied-filters ml" v-if="appliedStates.length && appliedStates.length < 3">
              <span style="font-weight: 600;"> Article State </span> 
              <div class="item" v-for="state in appliedStates" :key="state">
                [[getState(state)]]
              </div>
            </div>
  
            <div class="applied-filters ml" v-else-if="appliedStates.length">
              <span style="font-weight: 600;"> Article State </span> 
              <div class="item">
                [[getState(appliedStates[0])]]
              </div>
              <div class="item">
                [[getState(appliedStates[1])]]
              </div>
              <div class="item">
                +[[appliedStates.length-2]]
              </div>
            </div>
          </div>

          <!-- Data Bases Applied Filters -->
          <div class="applied-filters ml" v-if="selectedDatabases.length && selectedDatabases.length < 3">
            <span style="font-weight: 600;"> DataBase </span> 
            <div class="item" v-for="db in selectedDatabases" :key="db">
              [[db]]
            </div>
          </div>

          <div class="applied-filters ml" v-else-if="selectedDatabases.length">
            <span style="font-weight: 600;"> DataBase </span> 
            
            <div class="item">
              [[ selectedDatabases[0] ]]
            </div>
            <div class="item">
              [[ selectedDatabases[1] ]]
            </div>
            <div class="item">
              +[[selectedDatabases.length-2]]
            </div>
          </div>


          <!-- Tags Applied Filters -->
          <div class="applied-filters ml" v-if="selectedTags.length && selectedTags.length < 3">
            <span style="font-weight: 600;"> Article Tags </span> 
            <div class="item" v-for="tag in selectedTags" :key="tag">
              [[tag]]
            </div>
          </div>

          <div class="applied-filters ml" v-else-if="selectedTags.length">
            <span style="font-weight: 600;"> Article Tags </span> 
            
            <div class="item">
              [[ selectedTags[0] ]]
            </div>
            <div class="item">
              [[ selectedTags[1] ]]
            </div>
            <div class="item">
              +[[selectedTags.length-2]]
            </div>
          </div>


          <div class="filter-button ml" v-if="isFiltersApplied || searchTerm" v-on:click="onClearFilters">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 3.98665C11.78 3.76665 9.54667 3.65332 7.32 3.65332C6 3.65332 4.68 3.71999 3.36 3.85332L2 3.98665" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5.6665 3.31331L5.81317 2.43998C5.91984 1.80665 5.99984 1.33331 7.1265 1.33331H8.87317C9.99984 1.33331 10.0865 1.83331 10.1865 2.44665L10.3332 3.31331" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12.5664 6.09332L12.1331 12.8067C12.0598 13.8533 11.9998 14.6667 10.1398 14.6667H5.85977C3.99977 14.6667 3.93977 13.8533 3.86644 12.8067L3.43311 6.09332" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6.88672 11H9.10672" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6.3335 8.33331H9.66683" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Clear Filters
          </div>

          <div class="slider" id="filters-slider">
            <div class="slider-dialog">
              <div class="slider-dialog-inner ">
                <div class="slider-header">
                  <button class="pagintaion-item mr" v-on:click="onCloseFilters">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M10.0002 13.28L5.65355 8.93333C5.14022 8.42 5.14022 7.58 5.65355 7.06667L10.0002 2.72" stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  Filters
                </div>

                <div class="slider-content">
                  
                  <div class="filter-section" v-if="articleTags.length">
                    <div class="header"> TAG </div>
                    <div class="filter-selects"> 
                      <div class="" v-for="tag in articleTags" :key="tag.id"> 
                        <div class="filter-badge c-pointer"  :style="filterTagStyle(tag)" v-on:click="toggleTag(tag.name)">  
                          [[tag.name]] 
                        </div>
                      </div>
                    </div>
                  </div>  

                  <div class="filter-section">
                    <div class="header">SCORE</div>
                    <div class="filter-selects-score">
                      <div class="range-container">
                        <div class="sliders-control">
                          <div ref="fromSliderTooltip" class="slider-tooltip">[[fromScoreValue]]</div>
                          <input id="fromSlider" ref="fromSlider" type="range" v-model="fromScoreValue" :min="minScoreValue" :max="maxScoreValue" @input="controlFromSlider" />
                          <div ref="toSliderTooltip" class="slider-tooltip">[[toScoreValue]]</div>
                          <input id="toSlider" ref="toSlider" type="range" v-model="toScoreValue"  :min="minScoreValue" :max="maxScoreValue" @input="controlToSlider" />
                        </div>
                        <!--scale steps defined by data-steps value -->
                        <div id="scale" class="scale" :data-steps="steps"></div>
                      </div>
                    </div>
                  </div>

                  <div v-if="!isUnclassified" class="filter-section">
                    <div class="header"> STATE </div>
                    <div class="filter-selects"> 
                      <div :class="selectedStates.includes('U') ? 'filter-select selected' : 'filter-select'" v-on:click="toggleState('U')">  
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="3" cy="3" r="3" fill="#5925DC"/>
                        </svg>
                        Unclassified 
                      </div>
                      <div :class="selectedStates.includes('I') ? 'filter-select selected' : 'filter-select'" v-on:click="toggleState('I')"> 
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="3" cy="3" r="3" fill="#D1F573"/>
                        </svg>
                        Retained 
                      </div>
                      <div :class="selectedStates.includes('M') ? 'filter-select selected' : 'filter-select'" v-on:click="toggleState('M')"> 
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="3" cy="3" r="3" fill="#5925DC"/>
                        </svg>
                        Maybe 
                      </div>
                      <div :class="selectedStates.includes('E') ? 'filter-select selected' : 'filter-select'" v-on:click="toggleState('E')">  
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="3" cy="3" r="3" fill="#B42318"/>
                        </svg>
                        Excluded 
                      </div>
                      <div :class="selectedStates.includes('D') ? 'filter-select selected' : 'filter-select'" v-on:click="toggleState('D')"> 
                        <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <circle cx="3" cy="3" r="3" fill="#B55F08"/>
                        </svg>
                        Duplicate 
                      </div>
                    </div>
                  </div>
                    
                  <div class="filter-section" v-if="dbs.length">
                    <div class="header"> DATABASE </div>
                    <h3 class="mt-3"> Clinical Trials Databases </h3>
                    <div class="filter-checks"> 
                      <div class="filter-check" v-for="db in dbs" :key="db.id" v-if="!db.is_ae && !db.is_recall"> 
                        <label :for="db.entrez_enum"> 
                          <img src="{% static 'assets/client_portal/img/db-icon-blue.svg' %}" class="db-icon-selection">
                          [[db.displayed_name]]
                        </label> 
                        <input type="checkbox" v-model="selectedDatabases" name="database" :value="db.entrez_enum" :id="db.entrez_enum"/>
                      </div>
                    </div>
                  </div>
                </div>
              
                <div class="slider-footer">
                  <button class="primary-button" v-on:click="onSearch">
                    Apply Filters
                  </button>
                </div>

              </div>
            </div>
          </div>
        </div>  

        <table v-if="articles.length && viewType === 'Table View'" class="custom-table" >
          <thead>
            <tr>
                <th style="width: 35px;">
                  <input type="checkbox" name="check-article" ref="checkAll" v-model="isCheckAll" />
                </th>
          
                <th v-on:click="sortBy('id')" style="width: 100px;">
                    ID
                    <img src="{% static 'images/icons/filter.png' %}" />
                </th>
                <th>
                    <span v-on:click="sortBy('article__title')" >
                        Title
                        <img src="{% static 'images/icons/filter.png' %}" />
                    </span>
                </th>
                <th>
                  Abstract
                </th>
                <th>
                  Citation
                </th>
                <th style="width: 120px;">State</th>
                <th style="width: 120px;"> Database </th>   
                <th style="width: 200px;"> Tags </th>      
                <th style="width: 80px;">
                    <span v-on:click="sortBy('score')">
                        Score
                        <img src="{% static 'images/icons/filter.png' %}" />
                    </span>
                </th>
                <th style="width: 60px;">
                  <span> PDF </span>
                </th>
                <!-- <th style="width: 270px;">
                  Actions
                </th> -->
            </tr>
          </thead>
          <tbody>
            <tr v-for="review in articles" :id="'review-'+review.id" :key="review.id">
              <td> 
                <input type="checkbox" name="check-article" v-model="selectedReviews" :value="review.id" /> 
              </td>
              <td> 
                 #[[ review.id ]]
              </td>

              <td>
                <!-- <a :href="review.absolute_url+'?back={{ request.path  }}'" class="exclude-link" :title="review.article.title">
                [[ review.article.title.slice(0, 30)]]...
                </a>  -->
                <a v-on:click="onShowArticleDetails(review)" class="exclude-link c-pointer" :title="review.article.title">
                [[ truncateText(review.article.title) ]]
                </a> 

                <div class="slider article-details-slider" :id="'article-details-'+review.id">
                  <div class="slider-dialog">
                    <div class="slider-dialog-inner ">
                      <div class="slider-header">
                        <button v-on:click="hideArticleDetails(review)" class="pagintaion-item mr" type="button">
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10.0002 13.28L5.65355 8.93333C5.14022 8.42 5.14022 7.58 5.65355 7.06667L10.0002 2.72"
                              stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                              stroke-linejoin="round" />
                          </svg>
                        </button>
                        Detail View
                      </div>
  
                      <div v-if="currentArticle.selected">
                        <div class="slider-content">
                          <h2 class="mb-2">
                            {% autoescape off %}
                              <span v-if="!review.processed_title"> [[review.article.title]] </span>
                              <span v-else v-html="review.processed_title"> </span>
                            {% endautoescape %}
                          </h2>
                          <div class="center-v mb-2"> 
                            <div class="litreview-icon">
                              <img
                                src="{% static 'images/icons/lit-review-icon-black.png' %}"
                                alt="lit-review-icon"
                              />
                            </div>
                            <div class="ml-2">
                              <div class="center-v"> 
                                <div> [[review.database.displayed_name]]  </div>
                                <a :href="review.database.url" class="db-link tooltip" target="_blank">
                                  <div 
                                    class="c-pointer ml" style="width: 14px;"
                                    title="link to source"
                                  >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none" class="link-svg">
                                      <path d="M5.4375 2H3.1875C2.25552 2 1.5 2.75552 1.5 3.68749V9.31251C1.5 10.2445 2.25552 11 3.1875 11H8.8125C9.74448 11 10.5 10.2445 10.5 9.31251V7.06247M7.68722 2.00014L10.5 2M10.5 2V4.5313M10.5 2L5.71834 6.78109" stroke="#9BA5B9" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </div>
                                </a>
                              </div>
                              <div v-if="review.database.is_ae || review.database.is_recall" class="hint"> Adverse Event </div>
                              <div v-else class="hint"> Clinical Literature </div>
                            </div>
                          </div> 
                          
                          <div class="abstract hint mb-2">
                            {% autoescape off %}
                              <span v-if="review.processed_abstract" v-html="review.processed_abstract">
                              </span>
                              <span v-else v-html="review.article.abstract">
                              </span>
                            {% endautoescape %}
                          </div>
  
                          <div v-if="review.article.citation" class="info-card mb-2" v-html="review.article.citation"></div>
  
                          <div v-if="review.article.full_text" class="info-card mb-2">
                            <a class="center-v" :href="review.article.full_text" target="_blank">
                                <div class="file-download-icon mr">
                                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_213_6862)">
                                        <path d="M4.46877 19.25L2.74658 17.5312H4.46877V19.25ZM17.5313 19.25L19.2535 17.5312H17.5313V19.25Z" fill="#A3313A"/>
                                        <path d="M17.5312 4.46876H14.7847V1.7222L17.5312 4.46876Z" fill="#B2B2B2"/>
                                        <path d="M14.7812 1.71875H5.01531C4.87036 1.71875 4.73133 1.77633 4.62883 1.87883C4.52633 1.98133 4.46875 2.12036 4.46875 2.26531V19.7966C4.46875 19.9418 4.52622 20.0812 4.62862 20.1843C4.73103 20.2873 4.87004 20.3457 5.01531 20.3466H16.9847C17.0581 20.3461 17.1307 20.331 17.1981 20.3021C17.2656 20.2732 17.3266 20.2311 17.3776 20.1782C17.4285 20.1254 17.4683 20.0628 17.4947 19.9943C17.5211 19.9258 17.5335 19.8527 17.5312 19.7794V4.46875H14.7812V1.71875Z" fill="#F1F1F1"/>
                                        <path d="M3.09375 11.3438H18.9062C18.9974 11.3438 19.0849 11.38 19.1493 11.4444C19.2138 11.5089 19.25 11.5963 19.25 11.6875V17.5312H2.75V11.6875C2.75 11.5963 2.78622 11.5089 2.85068 11.4444C2.91515 11.38 3.00258 11.3438 3.09375 11.3438Z" fill="#C84D52"/>
                                        <path d="M8.13672 14.8259V15.8125H7.44922V13.0006H8.54922C8.82664 12.9811 9.10063 13.0712 9.31234 13.2516C9.40371 13.3401 9.47471 13.4474 9.52042 13.5662C9.56613 13.6849 9.58544 13.8121 9.57703 13.9391C9.57883 14.1013 9.53856 14.2611 9.46016 14.4031C9.37963 14.5421 9.26012 14.6545 9.11641 14.7263C8.94171 14.8096 8.74954 14.8497 8.55609 14.8431L8.13672 14.8259ZM8.89297 13.9219C8.89297 13.6744 8.75547 13.5506 8.48047 13.5506H8.13672V14.2828H8.48047C8.75547 14.2828 8.89297 14.1625 8.89297 13.9219ZM12.2686 15.125C12.151 15.337 11.9742 15.5102 11.7598 15.6234C11.5189 15.7475 11.2505 15.809 10.9795 15.8022H9.91734V13.0006H10.9795C11.2501 12.9935 11.5183 13.0537 11.7598 13.1759C11.9749 13.2867 12.152 13.459 12.2686 13.6709C12.3892 13.8958 12.4496 14.148 12.4439 14.4031C12.447 14.6547 12.3867 14.9029 12.2686 15.125ZM11.5364 14.9841C11.6787 14.8193 11.7569 14.6088 11.7569 14.3911C11.7569 14.1734 11.6787 13.9629 11.5364 13.7981C11.3658 13.6495 11.1435 13.5742 10.9177 13.5884H10.598V15.1938H10.9177C11.1421 15.2109 11.3642 15.1393 11.5364 14.9944V14.9841ZM14.6645 13.0006V13.5438H13.5095V14.1591H14.3998V14.6747H13.5095V15.8125H12.822V13.0006H14.6645Z" fill="white"/>
                                        <path d="M11.3092 3.61967C11.3345 3.85793 11.3111 4.09886 11.2404 4.3278C10.9345 5.38311 9.91013 9.22967 9.1367 9.77624C8.03326 10.56 7.4592 9.66967 8.04701 9.03717C8.63482 8.40467 12.1823 7.56249 13.3133 7.56249C14.7845 7.56249 14.5954 8.8653 13.7601 8.78624C12.8183 8.69686 10.4636 7.09155 10.3226 4.03905C10.2608 2.9528 11.2026 2.74999 11.3092 3.61967Z" stroke="#C84D52" stroke-miterlimit="10"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_213_6862">
                                            <rect width="22" height="22" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>
                                </div>
                                Article Full Text Click To Preview
                            </a>
                          </div>
                          
                          <div class="mt-2">
                            <a v-if="review.article.url":href="review.article.url" class="link primary-link" target="_blank"> View Source Link </a>
                            <span v-else class="badge warning w-max"> Source Link Unavailable. </span>
                          </div>

                          <div v-if="review.state_symbole === 'I'">
                            <a :href="review.clinical_app_link" class="secondary-gray-button w-100 mt-2" target="_blank"> Clinical Appraisal Review </a>
                          </div>
                          
                          <div v-if="review.article.keywords_list" class="mt-2">
                            <h4> Article Keywords </h4>
                            <div class="abstract hint mt"> 
                              <span v-for="kw in review.article.keywords_list"> [[kw]] , </span>
                            </div>
                          </div>

                          <div>
                            <label :for="'article-note'+review.id"> Article Notes </label>
                            <textarea
                              rows="4"
                              :id="'article-note'+review.id"
                              v-model="currentArticle.notes"
                            >
                            </textarea>
                          </div>
                        </div>
                        
                        <div class="horizantal-devider mb-2 mt-2"> </div>
  
                        <div class="slider-content">
                          <h2 class="mb-2"> Change Article State </h2>
                          <h3 class="hint mb-2"> You can choose the state and click change button </h3>
                          
                          <div class="mb-2">
                            <label> Article Tags: </label>
                            <div class="actions-content center-v"> 
                              <div 
                                  v-for="tag in review.tags"
                                  class="mr-2 badge" 
                                  :style="formTagStyle(tag)"
                                  :key="tag.id"
                                >
                                    [[tag.name]]
                                    <div 
                                      v-on:click="onChangeArticleTags(tag.id, $event, true)" 
                                      class="c-pointer remove-tag-icon"
                                      :object-id="review.id"
                                    >
                                      <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 3L3 9M9 9L3 3" stroke="#F04438" stroke-width="1.2" stroke-linecap="round"/>
                                      </svg>
                                    </div>
                                </div>
                                <div v-if="articleTagsOptions.length > 1" class="w-max add-tag-select">
                                  <custom-select
                                    :id="'add-tag'+review.id"
                                    :name="'add-tag'+review.id"
                                    :options="articleTagsOptions"
                                    :on-change="onChangeArticleTags"
                                    icon-url="{% static 'images/icons/plus-icon.png' %}"
                                    :object-id="review.id"
                                    :is-action-button="true"
                                  >
                                  </custom-select>
                                </div>
                                <div v-else class="add-tag-select">
                                  <div class="custom-select">
                                    <div class="custom-select-box" v-on:click="onNoTags">
                                      Add
                                      <div class="icon">
                                        <img src="{% static 'images/icons/plus-icon.png' %}" alt="plus">
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div> 
                          </div>
  
                          <div class="mb-2 article-state-dropdown">
                            <label :for="'article-state'+review.id"> Article State </label>
                            <custom-select
                              :id="'article-state'+review.id"
                              :name="'article-state'+review.id"
                              :options="statesOptions"
                              :default-selected="review.state_symbole"
                              :on-change="onCurrentArticleStateChange"
                            >
                            </custom-select>
                          </div>
  
                          <div v-if="currentArticle.state_symbole === 'E'" class="mb-2 article-state-dropdown">
                            <label :for="'exclusion-reason'+review.id"> Exclusion Reason </label>
                            <custom-select
                              :id="'exclusion-reason'+review.id"
                              :name="'exclusion-reason'+review.id"
                              :options="exclusionOptions"
                              :default-selected="review.exclusion_reason"
                              :on-change="onCurrentArticleExclusionReasonChange"
                            >
                            </custom-select>
                          </div>
  
                          <div v-if="currentArticle.state_symbole === 'E'">
                            <label :for="'exclusion-comment'+review.id"> 
                              Add an extra comment to the selected exclusion reason 
                              <span class="hint"> (Optional) </span> 
                            </label>
                            
                            <textarea
                              rows="4"
                              :id="'exclusion-comment'+review.id"
                              v-model="currentArticle.exclusionComment"
                            >
                            </textarea>
                          </div>
  
                        </div>
  
                        <div class="horizantal-devider mb-2 mt-2"> </div>
                        
                        <div class="slider-content">
                          <h2 class="mb-2"> Previous Projects Reviews </h2>
                          <table class="custom-table">
                              <thead>
                                <tr>
                                    <th style="width: 220px;"> Article </th>
                                    <th> Company </th>
                                    <th> Project Name - Device</th>
                                    <th> Feedback </th>
                                </tr>
                              </thead>
                              <tbody>
                                  <tr v-for="history_review in currentArticle.history" :key="history_review.id">
                                      <td> 
                                        <a :href="history_review.absolute_url" target="_blank">
                                          {% autoescape off %}
                                            <span v-if="!history_review.processed_title"> [[history_review.article.title]] </span>
                                            <span v-else v-html="history_review.processed_title"> </span>
                                          {% endautoescape %}
                                        </a> 
                                      </td>
                                      <td> [[history_review.client]] </td>
                                      <td> [[history_review.literature_review]] </td>
                                      <td> [[history_review.state]] </td>
                                  </tr>
                              </tbody>
                          </table>
                        </div>

                        <!-- Comments Section -->
                        <div class="horizantal-devider mb-2 mt-2"> </div>
                        <div class="slider-content">
                          <h2 class="mb-2"> Comments </h2>
                          <div>
                            <label :for="'article-note'+review.id"> Add Comment </label>
                            <textarea
                              rows="3"
                              v-model="comment.text"
                            >
                            </textarea>
                            <button :disabled="isLoading" v-on:click="onAddComment(review)"  class="primary-button mt-2"> Add Comment </button>
                            <div class="horizantal-devider mb-2 mt-2"> </div>
                            <div class="border">
                              <div v-for="comment in comments" class="info-card mb-2">
                                <div class="center-v" style="justify-content: space-between">
                                  <h3 class>[[ comment.user.username]] </h3>  
                                  <span class="hint"> [[ convertDate(comment.created_at)]]</span>
                                </div>
                                <div class=" mb-2 mt-2" > [[ comment.text ]] </div>
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>  
  
                      <div class="slider-footer">
                        <button v-on:click="hideArticleDetails(review)" type="button" class="secondary-gray-button"> Cancel </button>
                        <button 
                          v-on:click="onUpdateArticle" 
                          type="button" 
                          class="primary-button ml-2" 
                          :class="{ loading: isArticleUpdateLoading }"
                          :disabled="isArticleUpdateLoading"
                        > 
                          Save 
                        </button>
                        <button 
                          v-on:click="onUpdateArticle($event ,true)" 
                          type="button" 
                          class="primary-button ml-2" 
                          :class="{ loading: isArticleUpdateLoading }"
                          :disabled="isArticleUpdateLoading"
                        > 
                          Save and Next 
                        </button>
                      </div>
  
                    </div>
                  </div>
                </div>

              </td>

              <td>
                <div :title="review.article.abstract" v-html="truncateText(review.article.abstract)"></div>
              </td>

              <td>
                <div :title="review.article.citation" v-html="truncateText(review.article.citation)"></div>
              </td>
              
              <td> 
                <span :class="getStateClassName(review.state_symbole)"> 
                  [[ review.state ]] 
                </span>
              </td>
              
              <td> 
                <span> 
                  [[ review.database.displayed_name ]] 
                </span>
              </td>
              
              <td>
                <div style="position: relative;">
                  <div :ref="'term-section-'+review.id" class="table-view-tags"> 
                    <div 
                      v-for="tag in review.tags"
                      class="badge m-auto mb" 
                      :style="formTagStyle(tag)"
                      :key="tag.id"
                    >
                      [[tag.name]]
                    </div>
                    <button 
                      v-if="isShowTagExpand(review.id)" 
                      v-on:click="onExpandTagsSection(review.id)"
                      class="secondary-gray-button expand-button" 
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <path d="M8.28705 2.3335H11.6666M11.6666 2.3335V5.71281M11.6666 2.3335L7.7238 6.27603M5.71279 11.6668H2.33325M2.33325 11.6668V8.28752M2.33325 11.6668L6.27604 7.7243" stroke="#9BA5B9" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </td>

              <td>
                <span :class="review.score < 0 ? 'badge error' : review.score > 20 ? 'badge success' : 'badge info'">
                  [[ review.score ]]
                </span>
              </td> 
              <td>
                <div v-if="review.article.full_text" class="info-card w-max m-auto" style="padding: 2px;">
                  <a class="center-v w-max" :href="review.article.full_text" target="_blank">
                    <div class="file-download-icon">
                        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_213_6862)">
                            <path d="M4.46877 19.25L2.74658 17.5312H4.46877V19.25ZM17.5313 19.25L19.2535 17.5312H17.5313V19.25Z" fill="#A3313A"/>
                            <path d="M17.5312 4.46876H14.7847V1.7222L17.5312 4.46876Z" fill="#B2B2B2"/>
                            <path d="M14.7812 1.71875H5.01531C4.87036 1.71875 4.73133 1.77633 4.62883 1.87883C4.52633 1.98133 4.46875 2.12036 4.46875 2.26531V19.7966C4.46875 19.9418 4.52622 20.0812 4.62862 20.1843C4.73103 20.2873 4.87004 20.3457 5.01531 20.3466H16.9847C17.0581 20.3461 17.1307 20.331 17.1981 20.3021C17.2656 20.2732 17.3266 20.2311 17.3776 20.1782C17.4285 20.1254 17.4683 20.0628 17.4947 19.9943C17.5211 19.9258 17.5335 19.8527 17.5312 19.7794V4.46875H14.7812V1.71875Z" fill="#F1F1F1"/>
                            <path d="M3.09375 11.3438H18.9062C18.9974 11.3438 19.0849 11.38 19.1493 11.4444C19.2138 11.5089 19.25 11.5963 19.25 11.6875V17.5312H2.75V11.6875C2.75 11.5963 2.78622 11.5089 2.85068 11.4444C2.91515 11.38 3.00258 11.3438 3.09375 11.3438Z" fill="#C84D52"/>
                            <path d="M8.13672 14.8259V15.8125H7.44922V13.0006H8.54922C8.82664 12.9811 9.10063 13.0712 9.31234 13.2516C9.40371 13.3401 9.47471 13.4474 9.52042 13.5662C9.56613 13.6849 9.58544 13.8121 9.57703 13.9391C9.57883 14.1013 9.53856 14.2611 9.46016 14.4031C9.37963 14.5421 9.26012 14.6545 9.11641 14.7263C8.94171 14.8096 8.74954 14.8497 8.55609 14.8431L8.13672 14.8259ZM8.89297 13.9219C8.89297 13.6744 8.75547 13.5506 8.48047 13.5506H8.13672V14.2828H8.48047C8.75547 14.2828 8.89297 14.1625 8.89297 13.9219ZM12.2686 15.125C12.151 15.337 11.9742 15.5102 11.7598 15.6234C11.5189 15.7475 11.2505 15.809 10.9795 15.8022H9.91734V13.0006H10.9795C11.2501 12.9935 11.5183 13.0537 11.7598 13.1759C11.9749 13.2867 12.152 13.459 12.2686 13.6709C12.3892 13.8958 12.4496 14.148 12.4439 14.4031C12.447 14.6547 12.3867 14.9029 12.2686 15.125ZM11.5364 14.9841C11.6787 14.8193 11.7569 14.6088 11.7569 14.3911C11.7569 14.1734 11.6787 13.9629 11.5364 13.7981C11.3658 13.6495 11.1435 13.5742 10.9177 13.5884H10.598V15.1938H10.9177C11.1421 15.2109 11.3642 15.1393 11.5364 14.9944V14.9841ZM14.6645 13.0006V13.5438H13.5095V14.1591H14.3998V14.6747H13.5095V15.8125H12.822V13.0006H14.6645Z" fill="white"/>
                            <path d="M11.3092 3.61967C11.3345 3.85793 11.3111 4.09886 11.2404 4.3278C10.9345 5.38311 9.91013 9.22967 9.1367 9.77624C8.03326 10.56 7.4592 9.66967 8.04701 9.03717C8.63482 8.40467 12.1823 7.56249 13.3133 7.56249C14.7845 7.56249 14.5954 8.8653 13.7601 8.78624C12.8183 8.69686 10.4636 7.09155 10.3226 4.03905C10.2608 2.9528 11.2026 2.74999 11.3092 3.61967Z" stroke="#C84D52" stroke-miterlimit="10"/>
                            </g>
                            <defs>
                            <clipPath id="clip0_213_6862">
                                <rect width="22" height="22" fill="white"/>
                            </clipPath>
                            </defs>
                        </svg>
                    </div>
                  </a>
                </div>
              </td>       
              <!-- <td class="exclude-reason-body">
                <div class="center-v">
                  <button class="retain-button mr" v-on:click="onChangeArticleState(review.id, 'I')"> Retain </button>
                  <button class="maybe-button mr" v-on:click="onChangeArticleState(review.id, 'M')"> Maybe </button>
                  <exclude-button-drop-down
                    :review="review" 
                    :exclusions="exclusions"
                    :on-exclude-article="onExcludeArticle"
                  >
                  </exclude-button-drop-down>
                </div>
              </td>    -->
            </tr>
          </tbody>
        </table>
        
        <div v-else-if="viewType === 'Board View'" class="board-view">
          <ul class="board-header">
            <li class="check"> 
              <input type="checkbox" name="check-article" ref="checkAll" v-model="isCheckAll" />
            </li>
            
            <li  class="article"> 
              Article
            </li>

            <li class="details"> 
              Details
            </li>

          </ul>

          <ul v-for="review in articles" class="board-content" :key="review.id" :ref="'article-review-'+review.id">
            <li class="article-details">
              <div class="article-details-header c-pointer">
                <div style="width: 16px;">
                  <input type="checkbox" name="check-article" v-model="selectedReviews" :value="review.id" />
                </div>
                <div class="article-id hint"> #[[review.id]] </div>
                <div v-on:click="onShowArticleDetails(review)" class="center-v article-title-wrapper" style="align-items: start;">
                  <div class="article-title"> 
                    {% autoescape off %}
                      <span v-if="!review.processed_title"> [[review.article.title]] </span>
                      <span v-else v-html="review.processed_title"> </span>
                    {% endautoescape %}
                    <span>
                      <span v-if="review.is_sota_term">
                          - (Sota)
                      </span>
                      <span v-else>
                          - (Device)
                      </span>
                    </span>
                  </div>
                  <div class="article-link">
                    <div 
                      class="c-pointer ml" style="width: 14px;"
                      title="open-article"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none" class="link-svg">
                        <path d="M5.4375 2H3.1875C2.25552 2 1.5 2.75552 1.5 3.68749V9.31251C1.5 10.2445 2.25552 11 3.1875 11H8.8125C9.74448 11 10.5 10.2445 10.5 9.31251V7.06247M7.68722 2.00014L10.5 2M10.5 2V4.5313M10.5 2L5.71834 6.78109" stroke="#9BA5B9" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <div class="slider article-details-slider" :id="'article-details-'+review.id">
                <div class="slider-dialog">
                  <div class="slider-dialog-inner ">
                    <div class="slider-header">
                      <button v-on:click="hideArticleDetails(review)" class="pagintaion-item mr" type="button">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M10.0002 13.28L5.65355 8.93333C5.14022 8.42 5.14022 7.58 5.65355 7.06667L10.0002 2.72"
                            stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                            stroke-linejoin="round" />
                        </svg>
                      </button>
                      Detail View
                    </div>

                    <div v-if="currentArticle.selected">
                      <div class="slider-content">
                        <h2 class="mb-2"> 
                          {% autoescape off %}
                            <span v-if="!review.processed_title"> [[review.article.title]] </span>
                            <span v-else v-html="review.processed_title"></span>
                          {% endautoescape %}
                        </h2>
                        <div class="center-v mb-2"> 
                          <div class="litreview-icon">
                            <img
                              src="{% static 'images/icons/lit-review-icon-black.png' %}"
                              alt="lit-review-icon"
                            />
                          </div>
                          <div class="ml-2">
                            <div class="center-v"> 
                              <div> [[review.database.displayed_name]]  </div>
                              <a :href="review.database.url" class="db-link tooltip" target="_blank">
                                <div 
                                  class="c-pointer ml" style="width: 14px;"
                                  title="link to source"
                                >
                                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none" class="link-svg">
                                    <path d="M5.4375 2H3.1875C2.25552 2 1.5 2.75552 1.5 3.68749V9.31251C1.5 10.2445 2.25552 11 3.1875 11H8.8125C9.74448 11 10.5 10.2445 10.5 9.31251V7.06247M7.68722 2.00014L10.5 2M10.5 2V4.5313M10.5 2L5.71834 6.78109" stroke="#9BA5B9" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </div>
                              </a>
                            </div>
                            <div v-if="review.database.is_ae || review.database.is_recall" class="hint"> Adverse Event </div>
                            <div v-else class="hint"> Clinical Literature </div>
                          </div>
                        </div> 
                        
                        <div class="abstract hint mb-2">
                          {% autoescape off %}
                            <span v-if="review.processed_abstract" v-html="review.processed_abstract">
                            </span>
                            <span v-else v-html="review.article.abstract"></span>
                          {% endautoescape %}
                        </div>

                        <div v-if="review.article.citation" class="info-card mb-2" v-html="review.article.citation" ></div>
                        <div v-if="review.article.full_text" class="info-card mb-2">
                          <a class="center-v" :href="review.article.full_text" target="_blank">
                              <div class="file-download-icon mr">
                                  <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <g clip-path="url(#clip0_213_6862)">
                                      <path d="M4.46877 19.25L2.74658 17.5312H4.46877V19.25ZM17.5313 19.25L19.2535 17.5312H17.5313V19.25Z" fill="#A3313A"/>
                                      <path d="M17.5312 4.46876H14.7847V1.7222L17.5312 4.46876Z" fill="#B2B2B2"/>
                                      <path d="M14.7812 1.71875H5.01531C4.87036 1.71875 4.73133 1.77633 4.62883 1.87883C4.52633 1.98133 4.46875 2.12036 4.46875 2.26531V19.7966C4.46875 19.9418 4.52622 20.0812 4.62862 20.1843C4.73103 20.2873 4.87004 20.3457 5.01531 20.3466H16.9847C17.0581 20.3461 17.1307 20.331 17.1981 20.3021C17.2656 20.2732 17.3266 20.2311 17.3776 20.1782C17.4285 20.1254 17.4683 20.0628 17.4947 19.9943C17.5211 19.9258 17.5335 19.8527 17.5312 19.7794V4.46875H14.7812V1.71875Z" fill="#F1F1F1"/>
                                      <path d="M3.09375 11.3438H18.9062C18.9974 11.3438 19.0849 11.38 19.1493 11.4444C19.2138 11.5089 19.25 11.5963 19.25 11.6875V17.5312H2.75V11.6875C2.75 11.5963 2.78622 11.5089 2.85068 11.4444C2.91515 11.38 3.00258 11.3438 3.09375 11.3438Z" fill="#C84D52"/>
                                      <path d="M8.13672 14.8259V15.8125H7.44922V13.0006H8.54922C8.82664 12.9811 9.10063 13.0712 9.31234 13.2516C9.40371 13.3401 9.47471 13.4474 9.52042 13.5662C9.56613 13.6849 9.58544 13.8121 9.57703 13.9391C9.57883 14.1013 9.53856 14.2611 9.46016 14.4031C9.37963 14.5421 9.26012 14.6545 9.11641 14.7263C8.94171 14.8096 8.74954 14.8497 8.55609 14.8431L8.13672 14.8259ZM8.89297 13.9219C8.89297 13.6744 8.75547 13.5506 8.48047 13.5506H8.13672V14.2828H8.48047C8.75547 14.2828 8.89297 14.1625 8.89297 13.9219ZM12.2686 15.125C12.151 15.337 11.9742 15.5102 11.7598 15.6234C11.5189 15.7475 11.2505 15.809 10.9795 15.8022H9.91734V13.0006H10.9795C11.2501 12.9935 11.5183 13.0537 11.7598 13.1759C11.9749 13.2867 12.152 13.459 12.2686 13.6709C12.3892 13.8958 12.4496 14.148 12.4439 14.4031C12.447 14.6547 12.3867 14.9029 12.2686 15.125ZM11.5364 14.9841C11.6787 14.8193 11.7569 14.6088 11.7569 14.3911C11.7569 14.1734 11.6787 13.9629 11.5364 13.7981C11.3658 13.6495 11.1435 13.5742 10.9177 13.5884H10.598V15.1938H10.9177C11.1421 15.2109 11.3642 15.1393 11.5364 14.9944V14.9841ZM14.6645 13.0006V13.5438H13.5095V14.1591H14.3998V14.6747H13.5095V15.8125H12.822V13.0006H14.6645Z" fill="white"/>
                                      <path d="M11.3092 3.61967C11.3345 3.85793 11.3111 4.09886 11.2404 4.3278C10.9345 5.38311 9.91013 9.22967 9.1367 9.77624C8.03326 10.56 7.4592 9.66967 8.04701 9.03717C8.63482 8.40467 12.1823 7.56249 13.3133 7.56249C14.7845 7.56249 14.5954 8.8653 13.7601 8.78624C12.8183 8.69686 10.4636 7.09155 10.3226 4.03905C10.2608 2.9528 11.2026 2.74999 11.3092 3.61967Z" stroke="#C84D52" stroke-miterlimit="10"/>
                                      </g>
                                      <defs>
                                      <clipPath id="clip0_213_6862">
                                          <rect width="22" height="22" fill="white"/>
                                      </clipPath>
                                      </defs>
                                  </svg>
                              </div>
                              Article Full Text Click To Preview
                          </a>
                        </div>
                        
                        <div class="mt-2">
                          <a v-if="review.article.url" :href="review.article.url" class="link primary-link" target="_blank"> View Source Link </a>
                          <span v-else class="badge warning  w-max"> Source Link Unavailable. </span>
                        </div>
                        
                        <div v-if="review.state_symbole === 'I'">
                          <a :href="review.clinical_app_link" class="secondary-gray-button w-100 mt-2" target="_blank"> Clinical Appraisal Review </a>
                        </div>
                        
                        <div v-if="review.article.keywords_list" class="mt-2">
                          <h4> Article Keywords </h4>
                          <div class="abstract hint mt">  
                            <span v-for="kw in review.article.keywords_list"> [[kw]] , </span>
                          </div>
                        </div>

                        <div>
                          <label :for="'article-note'+review.id"> Article Notes </label>
                          <textarea
                            rows="4"
                            :id="'article-note'+review.id"
                            v-model="currentArticle.notes"
                          >
                          </textarea>
                        </div>
                      </div>
                      
                      <div class="horizantal-devider mb-2 mt-2"> </div>

                      <div class="slider-content">
                        <h2 class="mb-2"> Change Article State </h2>
                        <h3 class="hint mb-2"> You can choose the state and click change button </h3>
                        
                        <div class="mb-2">
                          <label> Article Tags: </label>
                          <div class="actions-content center-v"> 
                            <div 
                                v-for="tag in review.tags"
                                class="mr-2 badge" 
                                :style="formTagStyle(tag)"
                                :key="tag.id"
                              >
                                  [[tag.name]]
                                  <div 
                                    v-on:click="onChangeArticleTags(tag.id, $event, true)" 
                                    class="c-pointer remove-tag-icon"
                                    :object-id="review.id"
                                  >
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M9 3L3 9M9 9L3 3" stroke="#F04438" stroke-width="1.2" stroke-linecap="round"/>
                                    </svg>
                                  </div>
                              </div>
                              <div v-if="articleTagsOptions.length > 1" class="w-max add-tag-select">
                                <custom-select
                                  id="add-tag"
                                  name="add-tag"
                                  :options="articleTagsOptions"
                                  :on-change="onChangeArticleTags"
                                  icon-url="{% static 'images/icons/plus-icon.png' %}"
                                  :object-id="review.id"
                                  :is-action-button="true"
                                >
                                </custom-select>
                              </div>
                              <div v-else class="add-tag-select">
                                <div class="custom-select">
                                  <div class="custom-select-box" v-on:click="onNoTags">
                                    Add
                                    <div class="icon">
                                      <img src="{% static 'images/icons/plus-icon.png' %}" alt="plus">
                                    </div>
                                  </div>
                                </div>
                              </div>
                          </div> 
                        </div>

                        <div class="mb-2 article-state-dropdown">
                          <label :for="'article-state'+review.id"> </label>
                          <custom-select
                            :id="'article-state'+review.id"
                            name="article-state"
                            :options="statesOptions"
                            :default-selected="review.state_symbole"
                            :on-change="onCurrentArticleStateChange"
                          >
                          </custom-select>
                        </div>

                        <div v-if="currentArticle.state_symbole === 'E'" class="mb-2 article-state-dropdown">
                          <label :for="'exclusion-reason'+review.id"> </label>
                          <custom-select
                            :id="'exclusion-reason'+review.id"
                            name="exclusion-reason"
                            :options="exclusionOptions"
                            :default-selected="review.exclusion_reason"
                            :on-change="onCurrentArticleExclusionReasonChange"
                          >
                          </custom-select>
                        </div>

                        <div v-if="currentArticle.state_symbole === 'E'">
                          <label :for="'exclusion-comment'+review.id"> 
                            Add an extra comment to the selected exclusion reason 
                            <span class="hint"> (Optional) </span> 
                          </label>
                          
                          <textarea
                            rows="4"
                            :id="'exclusion-comment'+review.id"
                            v-model="currentArticle.exclusionComment"
                          >
                          </textarea>
                        </div>

                      </div>

                      <div class="horizantal-devider mb-2 mt-2"> </div>
                      
                      <div class="slider-content">
                        <h2 class="mb-2"> Previous Projects Reviews </h2>
                        <table class="custom-table">
                            <thead>
                              <tr>
                                <th style="width: 220px;"> Article </th>
                                <th> Company </th>
                                <th> Project Name - Device</th>
                                <th> Feedback </th>
                              </tr>
                            </thead>
                            <tbody>
                                <tr v-for="history_review in currentArticle.history" :key="history_review.id">
                                    <td> 
                                      <a :href="history_review.absolute_url" target="_blank">
                                        {% autoescape off %}
                                          <span v-if="!history_review.processed_title"> [[history_review.article.title]] </span>
                                          <span v-else  v-html="history_review.processed_title"> </span>
                                        {% endautoescape %}
                                      </a> 
                                    </td>
                                    <td> [[history_review.client]] </td>
                                    <td> [[history_review.literature_review]] </td>
                                    <td> [[history_review.state]] </td>
                                </tr>
                            </tbody>
                        </table>
                      </div>

                      <!-- Comments Section -->
                      <div class="horizantal-devider mb-2 mt-2"> </div>
                      <div class="slider-content">
                        <h2 class="mb-2"> Comments </h2>
                        <div>
                          <label :for="'article-note'+review.id"> Add Comment </label>
                          <textarea
                            rows="3"
                            v-model="comment.text"
                          >
                          </textarea>
                          <button :disabled="isLoading" v-on:click="onAddComment(review)"  class="primary-button mt-2"> Add Comment </button>
                          <div class="horizantal-devider mb-2 mt-2"> </div>
                          <div class="border">
                            <div v-for="comment in comments" class="info-card mb-2">
                              <div class="center-v" style="justify-content: space-between">
                                <h3 class>[[ comment.user.username]] </h3>  
                                <span class="hint"> [[ convertDate(comment.created_at)]]</span>
                              </div>
                              <div class=" mb-2 mt-2" > [[ comment.text ]] </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>

                    <div class="slider-footer">
                      <button v-on:click="hideArticleDetails(review)" type="button" class="secondary-gray-button"> Cancel </button>
                      <button v-on:click="onUpdateArticle" type="button" class="primary-button ml-2" :disabled="isArticleUpdateLoading"> Save </button>
                      <button v-on:click="onUpdateArticle($event ,true)" type="button" class="primary-button ml-2" :disabled="isArticleUpdateLoading"> Save and Next </button>
                    </div>

                  </div>
                </div>
              </div>
              
              <div class="article-details-abstract">
                <div class="abstract">
                  {% autoescape off %}
                    <span v-if="review.processed_abstract" v-html="review.processed_abstract">
                    </span>
                    <span v-else v-html="review.article.abstract">                  
                    </span>
                  {% endautoescape %}
                </div>
                <div v-if="review.article.citation" class="info-card mt-2" v-html="review.article.citation"></div>

                <div class="info-card mt-2" v-if="review.article.full_text">
                  <a class="center-v" :href="review.article.full_text" target="_blank">
                      <div class="file-download-icon mr">
                          <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <g clip-path="url(#clip0_213_6862)">
                              <path d="M4.46877 19.25L2.74658 17.5312H4.46877V19.25ZM17.5313 19.25L19.2535 17.5312H17.5313V19.25Z" fill="#A3313A"/>
                              <path d="M17.5312 4.46876H14.7847V1.7222L17.5312 4.46876Z" fill="#B2B2B2"/>
                              <path d="M14.7812 1.71875H5.01531C4.87036 1.71875 4.73133 1.77633 4.62883 1.87883C4.52633 1.98133 4.46875 2.12036 4.46875 2.26531V19.7966C4.46875 19.9418 4.52622 20.0812 4.62862 20.1843C4.73103 20.2873 4.87004 20.3457 5.01531 20.3466H16.9847C17.0581 20.3461 17.1307 20.331 17.1981 20.3021C17.2656 20.2732 17.3266 20.2311 17.3776 20.1782C17.4285 20.1254 17.4683 20.0628 17.4947 19.9943C17.5211 19.9258 17.5335 19.8527 17.5312 19.7794V4.46875H14.7812V1.71875Z" fill="#F1F1F1"/>
                              <path d="M3.09375 11.3438H18.9062C18.9974 11.3438 19.0849 11.38 19.1493 11.4444C19.2138 11.5089 19.25 11.5963 19.25 11.6875V17.5312H2.75V11.6875C2.75 11.5963 2.78622 11.5089 2.85068 11.4444C2.91515 11.38 3.00258 11.3438 3.09375 11.3438Z" fill="#C84D52"/>
                              <path d="M8.13672 14.8259V15.8125H7.44922V13.0006H8.54922C8.82664 12.9811 9.10063 13.0712 9.31234 13.2516C9.40371 13.3401 9.47471 13.4474 9.52042 13.5662C9.56613 13.6849 9.58544 13.8121 9.57703 13.9391C9.57883 14.1013 9.53856 14.2611 9.46016 14.4031C9.37963 14.5421 9.26012 14.6545 9.11641 14.7263C8.94171 14.8096 8.74954 14.8497 8.55609 14.8431L8.13672 14.8259ZM8.89297 13.9219C8.89297 13.6744 8.75547 13.5506 8.48047 13.5506H8.13672V14.2828H8.48047C8.75547 14.2828 8.89297 14.1625 8.89297 13.9219ZM12.2686 15.125C12.151 15.337 11.9742 15.5102 11.7598 15.6234C11.5189 15.7475 11.2505 15.809 10.9795 15.8022H9.91734V13.0006H10.9795C11.2501 12.9935 11.5183 13.0537 11.7598 13.1759C11.9749 13.2867 12.152 13.459 12.2686 13.6709C12.3892 13.8958 12.4496 14.148 12.4439 14.4031C12.447 14.6547 12.3867 14.9029 12.2686 15.125ZM11.5364 14.9841C11.6787 14.8193 11.7569 14.6088 11.7569 14.3911C11.7569 14.1734 11.6787 13.9629 11.5364 13.7981C11.3658 13.6495 11.1435 13.5742 10.9177 13.5884H10.598V15.1938H10.9177C11.1421 15.2109 11.3642 15.1393 11.5364 14.9944V14.9841ZM14.6645 13.0006V13.5438H13.5095V14.1591H14.3998V14.6747H13.5095V15.8125H12.822V13.0006H14.6645Z" fill="white"/>
                              <path d="M11.3092 3.61967C11.3345 3.85793 11.3111 4.09886 11.2404 4.3278C10.9345 5.38311 9.91013 9.22967 9.1367 9.77624C8.03326 10.56 7.4592 9.66967 8.04701 9.03717C8.63482 8.40467 12.1823 7.56249 13.3133 7.56249C14.7845 7.56249 14.5954 8.8653 13.7601 8.78624C12.8183 8.69686 10.4636 7.09155 10.3226 4.03905C10.2608 2.9528 11.2026 2.74999 11.3092 3.61967Z" stroke="#C84D52" stroke-miterlimit="10"/>
                              </g>
                              <defs>
                              <clipPath id="clip0_213_6862">
                                  <rect width="22" height="22" fill="white"/>
                              </clipPath>
                              </defs>
                          </svg>
                      </div>
                      Article Full Text Click To Preview
                  </a>
                </div>
                <div v-else-if="review.state_symbole === 'I'" class="mt-2 full-text-unavailable"> 
                  <div class="center-v">
                    <div class="file-download-icon mr">
                      <svg 
                        width="16" 
                        height="16" 
                        viewBox="0 0 16 16" 
                        fill="none" 
                        xmlns="http://www.w3.org/2000/svg"
                        style="height: 16px; margin-bottom: -3px;"
                      >
                        <path 
                          d="M8 8V5M8 10.2236V10.25M14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8Z" 
                          stroke="#B54708" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"
                        />
                      </svg>
                    </div>
                    Failed to auto download full text PDF for this article, has to be uploaded manually from  
                    <a href="{% url 'lit_reviews:full_text_upload' id=literature_review_id %}" target="_blank" class="ml"> Upload Full Text View </a>.
                  </div>
                </div>

                <div class="mt-2">
                  <a v-if="review.article.url" :href="review.article.url" class="link primary-link" target="_blank"> View Source Link </a>
                  <span v-else class="badge warning  w-max"> Source Link Unavailable. </span>
                </div>
              </div>
            </li>

            <li class="actions">
              <div class="actions-section"> 
                <div class="action-item">
                  <div class="actions-header"> TAG: </div>
                  <div class="actions-content"> 
                    <div 
                        v-for="tag in review.tags"
                        class="badge" 
                        :style="formTagStyle(tag)"
                        :key="tag.id"
                      >
                          [[tag.name]]
                          <div 
                            v-on:click="onChangeArticleTags(tag.id, $event, true)" 
                            class="c-pointer remove-tag-icon"
                            :object-id="review.id"
                          >
                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M9 3L3 9M9 9L3 3" stroke="#F04438" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                          </div>
                      </div>
                      <div v-if="articleTagsOptions.length > 1" class="w-max add-tag-select">
                        <custom-select
                          id="add-tag"
                          name="add-tag"
                          :options="articleTagsOptions"
                          :on-change="onChangeArticleTags"
                          icon-url="{% static 'images/icons/plus-icon.png' %}"
                          :object-id="review.id"
                          :is-action-button="true"
                        >
                        </custom-select>
                      </div>
                      <div v-else class="add-tag-select">
                        <div class="custom-select">
                          <div class="custom-select-box" v-on:click="onNoTags">
                            Add
                            <div class="icon">
                              <img src="{% static 'images/icons/plus-icon.png' %}" alt="plus">
                            </div>
                          </div>
                        </div>
                      </div>
                  </div> 
                </div>

                <div class="action-item center-v">
                  <div>
                    <div class="actions-header"> STATE: </div>
                    <div class="actions-content"> 
                      <div :class="getStateClassName(review.state_symbole)"> [[review.state]] </div>
                    </div>
                  </div>
                  <div style="margin-left: 40px;">
                    <div class="actions-header"> 
                      <div class="center-v">
                        SCORE:
                        <div 
                          v-on:click="showModal('score-modal-'+review.id)" 
                          style="width: 14px;" class="ml c-pointer" 
                          title="Wondering what is this for ? click for more info"
                        >
                          <img src="{% static 'images/icons/tooltip.svg' %}" alt="" srcset="">                        
                        </div>
                         
                      </div>
                    </div>
                    
                    <div class="modal" :id="'score-modal-'+review.id">
                      <div class="modal-dialog">
                        <div class="modal-content">
                         
                          <div class="modal-body">                                                                                                                                                    
                            <div class="hint mt-2">
                              Abstract Relevance Score is increased based on your selected Keywords. Read more about keywords here 
                              <a href="https://citemedical.notion.site/Complete-User-Guide-CiteMed-io-624483282e594f7d8bb71611100fd7cc#1889e05ab9aa48518aeee823af3765f6"
                               target="_blank" class="primary-link">
                                Wiki Instructions
                              </a>.
                            </div>        
                          </div>
                          <div class="modal-footer">
                            <button 
                              class="secondary-gray-button mt w-100"
                              v-on:click="hideModal('score-modal-'+review.id)" 
                              type="button"
                            > 
                              Close 
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="actions-content"> 
                      <div class="article-score center-v">
                        <svg v-if="review.score >= 0" width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M8.5 4L8.5 12M12.5 8L4.5 8" stroke="#21BD62" stroke-width="2" stroke-linecap="square"/>
                        </svg>
                        <svg v-else style="width: 18px" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M16 12L8 12" stroke="#F04438" stroke-width="2" stroke-linecap="square"/>
                        </svg>
                        <span :style="review.score >= 0 ? 'color: green' : 'color: red'">
                          [[Math.abs(review.score)]] 
                        </span>
                      </div>

                    </div>
                  </div>
                </div>

                <div class="action-item">
                  <div class="actions-header"> DATABASE: </div>
                  <div class="actions-content"> 
                    <div class="center-v"> 
                      <div class="litreview-icon">
                        <img
                          src="{% static 'images/icons/lit-review-icon-black.png' %}"
                          alt="lit-review-icon"
                        />
                      </div>
                      <div class="ml-2">     
                          <a :href="review.article.url" style="display: none;" :ref="'source-link-'+review.id" target="_blank"> </a>                     
                          <a v-on:click="onViewSource($event, review)" class="db-link tooltip" style="display: flex; align-items: center; cursor: pointer;">
                            <div> [[review.database.displayed_name]]  </div>
                            <div 
                              class="c-pointer ml" style="width: 14px; height: 11px;"
                              title="link to source"
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none" class="link-svg">
                                <path d="M5.4375 2H3.1875C2.25552 2 1.5 2.75552 1.5 3.68749V9.31251C1.5 10.2445 2.25552 11 3.1875 11H8.8125C9.74448 11 10.5 10.2445 10.5 9.31251V7.06247M7.68722 2.00014L10.5 2M10.5 2V4.5313M10.5 2L5.71834 6.78109" stroke="#9BA5B9" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          </a>
                        <div v-if="review.database.is_ae || review.database.is_recall" class="hint"> Adverse Event </div>
                        <div v-else class="hint"> Clinical Literature </div>
                      </div>
                    </div> 
                  </div>
                </div>
                <div class="action-item">
                  <div class="actions-header"> SEARCH TERM: </div>
                  <div v-if="review.search_term.length < 50" class="actions-content"> 
                    [[review.search_term]]
                  </div>
                  <div v-else class="actions-content"> 
                    <div :title="review.search_term">
                      [[review.search_term.slice(0, 50)]]...
                    </div>
                  </div>
                </div>
                <div class="action-item">
                  <div class="actions-header"> 
                    <div class="center-v">
                      <span class="tooltip-elt mr" title="the article state in the latest completed project for this article" style="margin-left: 0px;">
                        <img src="{% static 'images/icons/tooltip.svg' %}" alt="" srcset="">
                      </span>  
                      Historical State: 
                    </div>
                  </div>
                  <div class="actions-content" style="font-size: 11px;"> 
                    <div v-if="isHistoricalStatusLoading">
                      <spinner :width="30" :height="30" />
                    </div>
                    <span v-else :class="review.previous_article_state?.includes('Retained') ? 'link success-link' : review.previous_article_state?.includes('Excluded') ? 'link error-link' : ''">
                      [[ review.previous_article_state ? review.previous_article_state :  'No data available' ]]
                    </span>
                  </div>

                </div>
                <div class="action-item">
                  <button v-on:click="showModal('add-note-modal-'+review.id)" class="secondary-gray-button w-100" :disabled="isArchived"> 
                    <div class="center-v w-max m-auto">
                      <svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.40039 2.59998L12.6004 2.59998M7.70039 5.63331L12.6004 5.63331M7.70039 8.66664L12.6004 8.66664M1.40039 11.7H12.6004M2.10039 8.89998H4.20039C4.58699 8.89998 4.90039 8.58657 4.90039 8.19998V6.09998C4.90039 5.71338 4.58699 5.39998 4.20039 5.39998H2.10039C1.71379 5.39998 1.40039 5.71338 1.40039 6.09998V8.19998C1.40039 8.58657 1.71379 8.89998 2.10039 8.89998Z" stroke="#6B7281" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      <div class="ml-2">
                        Add a Note
                      </div>
                    </div>
                  </button>
                  <div class="modal" :id="'add-note-modal-'+review.id">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <form v-on:submit="onAddArticleNote($event, review.id)"> 
                          <div class="modal-header">
                            <div class="modal-header-icon-wrapper info-icon">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.8603 4.71026C16.0855 4.48508 16.3528 4.30646 16.647 4.18459C16.9413 4.06272 17.2566 4 17.575 4C17.8935 4 18.2088 4.06272 18.503 4.18459C18.7972 4.30646 19.0646 4.48508 19.2897 4.71026C19.5149 4.93544 19.6935 5.20276 19.8154 5.49697C19.9373 5.79118 20 6.10651 20 6.42497C20 6.74342 19.9373 7.05875 19.8154 7.35296C19.6935 7.64717 19.5149 7.9145 19.2897 8.13968L7.71545 19.714L3 21L4.28603 16.2845L15.8603 4.71026Z" stroke="#0A5CFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                            <div class="center-v">
                              Add note to article
                            </div>
                            <div class="hint mt">
                              Please write you note below then save it.
                              <br /> 
                              You can also update it later.
                            </div>
                          </div>
                          <div class="modal-body">
                            <label :for="'article-note-'+review.id"> </label>
                            <textarea 
                              :id="'article-note-'+review.id" 
                              rows="4" 
                              placeholder="Type your note here" name="article_note"
                            >[[ review.notes ? review.notes : ""]]</textarea>
                          </div>
                          <div class="modal-footer">
                            <button 
                              class="secondary-gray-button w-50" 
                              v-on:click="hideModal('add-note-modal-'+review.id)"
                              type="button"
                            > 
                              Cancel 
                            </button>
                            <button
                              class="primary-button w-50 ml" 
                              type="submit"
                            >   
                              Save
                            </button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="horizantal-devider"> </div>
              
              <div class="state-updated-alert" v-if="review.stateUpdatedByAnotherUser">
                <div 
                  :class="review.updatedReview.state_symbole == 'I' ? 'success' : review.updatedReview.state_symbole == 'E' ? 'error' : 'warning'" 
                  class="badge mt-2 mb-2 ml-2 mr-2 state-updated-alert-notification" 
                  style="display: block;"
                >
                  Another User (<strong> [[review.stateUpdatedByAnotherUser.by.username]] </strong>) Marked This Article As 
                  "<strong> [[review.stateUpdatedByAnotherUser.newState]] </strong>." Would You Like To Keep This Update?
                </div>
                <div class="state-updated-alert-actions"> 
                  <button 
                    v-on:click="updateArticle(review.updatedReview, true, false)" 
                    :class="review.updatedReview.state_symbole == 'I' ? 'success-button' : review.updatedReview.state_symbole == 'E' ? 'error-button' : 'warning-button'"
                    class="m-auto mb-2"
                    style="width: 60%;"
                  > 
                    Keep "[[review.stateUpdatedByAnotherUser.newState]]" 
                  </button> 

                  <div id="override-updated-article-parent" class="override-updated-article-parent">
                    <drop-down
                      icon-source="{% static 'images/icons/menu-dots.png' %}"
                      text="Override"
                      target-element="override-updated-article"
                      parent-wrapper="override-updated-article-parent"
                      position-right="0px"
                      position-top="35px"
                    >
                    </drop-down>
                    <div class="drop-down" id="override-updated-article">
                      <ul>
                        <li 
                          v-if="review.updatedReview.state_symbole != 'I'" 
                          v-on:click="onChangeArticleState(review.id, 'I')"
                          class="drop-down-element"
                        > 
                          <div> Retain </div>
                        </li>
                        <li 
                          v-if="review.updatedReview.state_symbole != 'M'"
                          v-on:click="onChangeArticleState(review.id, 'M')" 
                          class="drop-down-element"
                        > 
                          <div> Maybe </div>
                        </li>
                        <li v-if="review.updatedReview.state_symbole != 'E'">
                          <exclude-button-drop-down
                            :review="review" 
                            :exclusions="exclusions"
                            :on-exclude-article="onExcludeArticle"
                            :disabled="isArchived"
                          >
                          </exclude-button-drop-down>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="actions-footer update-state-actions">
                <button 
                  :class="['retain-button', { 'disabled': isArchived }, {'ai-suggested': isShowAISuggestions && review.ai_state_decision === 'I'}]" 
                  v-on:click="onChangeArticleState(review.id, 'I')" 
                  :disabled="isArchived"
                > 
                  <div 
                    class="center-v" 
                    :class="{'tooltip-elt': isShowAISuggestions && review.ai_state_decision === 'I'}" 
                    :title="isShowAISuggestions && review.ai_state_decision === 'I' ? 'AI Suggested' : ''"  
                  >
                    <img
                      v-if="isShowAISuggestions && review.ai_state_decision === 'I'" 
                      class="header-right-icon mr" 
                      style="width: 15px;" 
                      src="{% static 'images/icons/ai-white.png' %}" alt="show-pdf-file-icon" srcset=""
                    />
                    Retain 
                  </div>
                </button>
                <button 
                  :class="['maybe-button', { 'disabled': isArchived }, {'ai-suggested': isShowAISuggestions && review.ai_state_decision === 'M'}]" 
                  v-on:click="onChangeArticleState(review.id, 'M')" 
                  :disabled="isArchived"
                >
                  <div 
                    class="center-v" 
                    :class="{'tooltip-elt': isShowAISuggestions && review.ai_state_decision === 'M'}"                     
                    :title="isShowAISuggestions && review.ai_state_decision === 'M' ? 'AI Suggested' : ''"
                  >
                    <img
                      v-if="isShowAISuggestions && review.ai_state_decision === 'M'" 
                      class="header-right-icon mr" 
                      style="width: 15px;" 
                      src="{% static 'images/icons/ai-white.png' %}" alt="show-pdf-file-icon" srcset=""
                    />
                    Maybe 
                  </div>
                </button>
                <exclude-button-drop-down
                  :review="review" 
                  :exclusions="exclusions"
                  :on-exclude-article="onExcludeArticle"
                  :is-show-a-i-suggestions="isShowAISuggestions"
                  ai-icon="{% static 'images/icons/ai-white.png' %}"
                  ai-icon-blue="{% static 'images/icons/ai-icon-blue.png' %}"
                  :disabled="isArchived"
                >
                </exclude-button-drop-down>
              </div>
            </li>
          </ul>
        </div>
        
        <div v-else-if="isLoading"> 
          <loader header-text="Loading Results..." />
        </div>
        <div v-else>
          No reviews match this query.
        </div>
      
        <div class="table-footer" v-if="articles.length">
          <div class="left-section"> </div>
          <div class="middle-section"> 
            <div class="pagination">
              <span> 
                <button :class="pagination.previous ? 'pagintaion-item' : 'pagintaion-item disabled'" v-on:click="loadArticles(false, pagination.current-1)">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.0002 13.28L5.65355 8.93333C5.14022 8.42 5.14022 7.58 5.65355 7.06667L10.0002 2.72" stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </span>
      
              <div class="pagination-content">
                
                <button 
                  class="pagintaion-item" 
                  v-on:click="loadArticles(false, 1)" 
                  v-if="pagination.current > 1"
                > 1
                </button>
                <button class="seperator" v-if="pagination.current > 2"> ... </button>
      
                <button 
                  v-for="page in pagination.page_range" 
                  :class="page === pagination.current ? 'pagintaion-item selected' : 'pagintaion-item'"
                  v-if="page === pagination.current || ( page < pagination.last && page > 1)" 
                  v-on:click="loadArticles(false, page)"
                  :key="page"
                > 
                  [[page]]
                </button>
                <button class="seperator" v-if="pagination.current < pagination.last"> ... </button>
                <button 
                  class="pagintaion-item" 
                  v-on:click="loadArticles(false, pagination.last)" 
                  v-if="pagination.current < pagination.last"
                > [[pagination.last]]
                </button>
              </div>
      
              <span> 
                <button :class="pagination.next ? 'pagintaion-item' : 'pagintaion-item disabled'" v-on:click="loadArticles(false, pagination.current+1)" >
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5.93994 13.28L10.2866 8.93333C10.7999 8.42 10.7999 7.58 10.2866 7.06667L5.93994 2.72" stroke="#292D32" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </span>
            </div>
          </div>
          <div class="right-section"> 
            [[tablePageIndicator]]
          </div>
        </div>
      </div>
  
    </div>

    <form v-on:submit="onBulkStateUpdate" class="floated-actions" v-if="selectedReviews.length">
      <div>
        [[ selectedReviews.length ]] Selected
      </div>

      <div>
        <button v-on:click="showModal('add-bulk-note')" type="button" class="dark-button mr bulk-update" :disabled="isArchived"> 
          <div class="center-v" style="height: 16px;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.2502 7.99963H8.00025M8.00025 7.99963H5.75024M8.00025 7.99963V10.2496M8.00025 7.99963L8.00024 5.74965M14 4.24999L14 11.75C14 12.9926 12.9926 14 11.75 14H4.25C3.00736 14 2 12.9926 2 11.75V4.24999C2 3.00735 3.00736 2 4.25 2H11.75C12.9926 2 14 3.00735 14 4.24999Z" stroke="black" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <div class="ml">
              Add Note
            </div>
          </div>
        </button>
      </div>

      <div class="bulk-state-dropdown">
        <custom-select
          id="article-bulk-state"
          name="article-bulk-state"
          :options="statesOptions"
          :default-selected="bulkArticle.state_symbole"
          :on-change="onBulkArticleStateChange"
        >
        </custom-select>
      </div>

      <div v-if="bulkArticle.state_symbole === 'E'" class="bulk-state-dropdown" style="width: 300px;">
        <custom-select
          id="article-exclusion-reason-dropdown"
          name="article-exclusion-reason-dropdown"
          :options="exclusionOptions"
          :default-selected="bulkArticle.exclusionReason"
          :on-change="onBulkArticleExclusionReasonChange"
        >
        </custom-select>
      </div>

      <div v-if="bulkArticle.state_symbole === 'E'">
        <button v-on:click="showModal('add-bulk-exclusion-comment')" type="button" class="dark-button mr bulk-update" :disabled="isArchived"> 
          <div class="center-v" style="height: 16px;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.2502 7.99963H8.00025M8.00025 7.99963H5.75024M8.00025 7.99963V10.2496M8.00025 7.99963L8.00024 5.74965M14 4.24999L14 11.75C14 12.9926 12.9926 14 11.75 14H4.25C3.00736 14 2 12.9926 2 11.75V4.24999C2 3.00735 3.00736 2 4.25 2H11.75C12.9926 2 14 3.00735 14 4.24999Z" stroke="black" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <div class="ml"> Add Exclusion Comment </div>
          </div>
        </button>
  
      </div>

      <button type="submit" class="primary-button" :class="{ loading: isBulkUpdateLoading }" :disabled="isBulkUpdateLoading || isArchived">
        Apply
      </button>
  </form>

    <!-- Bulk Note Modal -->
    <div class="modal" id="add-bulk-note">
      <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <div class="modal-header-icon-wrapper info-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.8603 4.71026C16.0855 4.48508 16.3528 4.30646 16.647 4.18459C16.9413 4.06272 17.2566 4 17.575 4C17.8935 4 18.2088 4.06272 18.503 4.18459C18.7972 4.30646 19.0646 4.48508 19.2897 4.71026C19.5149 4.93544 19.6935 5.20276 19.8154 5.49697C19.9373 5.79118 20 6.10651 20 6.42497C20 6.74342 19.9373 7.05875 19.8154 7.35296C19.6935 7.64717 19.5149 7.9145 19.2897 8.13968L7.71545 19.714L3 21L4.28603 16.2845L15.8603 4.71026Z" stroke="#0A5CFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="center-v">
                Bulk Article Note
              </div>
              <div class="hint mt">
                Please write you note below then save it.
                <br /> 
                You can also update it later.
              </div>
            </div>
            <div class="modal-body">
              <label for="bulk-note"> </label>
              <textarea 
                v-model="bulkArticle.notes"
                id="bulk-note" 
                rows="4" 
                placeholder="Type your note here" 
                name="bulk-article-note"
              >
            </textarea>
            </div>
            <div class="modal-footer">
              <button
                class="primary-button w-100" 
                v-on:click="hideModal('add-bulk-note')"
                type="button"
              >   
                Save
              </button>
            </div>
        </div>
      </div>
    </div>

    <!-- Bulk Exclusion Comment Modal -->
    <div class="modal" id="add-bulk-exclusion-comment">
      <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <div class="modal-header-icon-wrapper info-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.8603 4.71026C16.0855 4.48508 16.3528 4.30646 16.647 4.18459C16.9413 4.06272 17.2566 4 17.575 4C17.8935 4 18.2088 4.06272 18.503 4.18459C18.7972 4.30646 19.0646 4.48508 19.2897 4.71026C19.5149 4.93544 19.6935 5.20276 19.8154 5.49697C19.9373 5.79118 20 6.10651 20 6.42497C20 6.74342 19.9373 7.05875 19.8154 7.35296C19.6935 7.64717 19.5149 7.9145 19.2897 8.13968L7.71545 19.714L3 21L4.28603 16.2845L15.8603 4.71026Z" stroke="#0A5CFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="center-v">
                Bulk Exclusion Comment
              </div>
            </div>
            <div class="modal-body">
              <label for="bulk-exclusion-comment"> </label>
              <textarea 
                v-model="bulkArticle.exclusionComment"
                id="bulk-exclusion-comment" 
                rows="4" 
                placeholder="Type your note here" 
                name="bulk-article-note"
              >
            </textarea>
            </div>
            <div class="modal-footer">
              <button
                class="primary-button w-100" 
                v-on:click="hideModal('add-bulk-exclusion-comment')"
                type="button"
              >   
                Save
              </button>
            </div>
        </div>
      </div>
    </div>

    <!-- KW Were Updated Modal -->
    <div class="modal" id="kw-updated-notification">
      <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <div class="modal-header-icon-wrapper warning-icon">
                <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M12 13.4V8.91447M12 16.7248V16.7642M17.6699 20.5H6.33007C4.7811 20.5 3.47392 19.4763 3.06265 18.0757C2.88709 17.4778 3.10281 16.8551 3.43276 16.3249L9.10269 6.10102C10.4311 3.96632 13.5689 3.96633 14.8973 6.10103L20.5672 16.3249C20.8972 16.8551 21.1129 17.4778 20.9373 18.0757C20.5261 19.4763 19.2189 20.5 17.6699 20.5Z"
                    stroke="#DC7003" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
              <div class="center-v">
                Project Keywords and Scores Updated
              </div>
            </div>
            <div class="modal-body">
              <div>
                The keywords for this project have been updated and processing is now complete. 
                Some article scores may have changed. Would you like to refresh the page to see the 
                latest updates before continuing your review?
              </div>
            </div>
            <div class="modal-footer">
              <button
                class="primary-button w-50" 
                v-on:click="loadArticles(false, 1)"
                type="button"
              >   
                Yes, refresh page.
              </button>
              <button
                class="secondary-gray-button w-50 ml-2" 
                v-on:click="hideModal('kw-updated-notification')"
                type="button"
              >   
                No, thanks!
              </button>
            </div>
            </div>
        </div>
      </div>
    </div>

    <!-- loader section -->
    <div class="update-loading-section" id="update-loading-section">
      <div class="update-loading-popup">
          <div class="mb-4">
              <img
              src="{% static 'images/new_logo.svg' %}"
              class="d-inline-block align-top"
              alt="citemed-logo"
              />
          </div>
          <div class="mt-3">
              Please don't refresh the page Until the process is completed.
          </div>
          <div class="update-loading-popup-progress"><div></div><div></div><div></div></div>
      </div>
    </div>

  </div>
{% endblock %}

{% block 'scripts-block' %} 
  <script>
    const ArticlesListAPI = "{% url 'lit_reviews:articles_list_api' id=literature_review_id %}";
    const ExclusionReasonAPI = "{% url 'lit_reviews:exclusion_reasons_list_api' id=literature_review_id %}";
    const ArticleTagsListAPI = "{% url 'lit_reviews:article_tags_api' id=literature_review_id %}";
    const bulkStateUpdateAPI = "{% url 'lit_reviews:bulk_state_update' id=literature_review_id %}"; 
    const ArticleReviewUpdateAPI = "{% url 'lit_reviews:article_review_update' id=literature_review_id review_id=0 %}"; 
    const ArticleReviewHistoryAPI = "{% url 'lit_reviews:article_review_history' id=literature_review_id review_id=0 %}"; 
    const ArticleCommentsListAPI = "{% url 'lit_reviews:articles_comments_api' id=literature_review_id review_id=0 %}";  
    const urlAddComment = "{% url 'lit_reviews:articles_add_comment_api' id=literature_review_id %}"; 
    const AISuggestionURL = "{% url 'lit_reviews:1st-pass-ai-suggestions' id=literature_review_id %}";
    const ArticlesHistoricalStatusAPI = "{% url 'lit_reviews:articles-historical-status-api' id=literature_review_id %}";
  </script>
  <script src="{% static "lit_reviews/vue/articles_list.js" %}" > </script>
{% endblock %}