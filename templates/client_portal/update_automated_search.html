{% extends "base_client_portal.html" %}
{% load static %}
 
{% block title %}
    <title>Update Automated Search</title>
{% endblock %}
{% block 'beforehead' %} 
    <!-- Required Stylesheets -->
    <link 
        type="text/css"
        rel="stylesheet"
        href="{% static 'css/bootstrap5.min.css' %}"
    />
    <link
        type="text/css"
        rel="stylesheet"
        href="{% static 'vue-cdn/bootstrap-vue-2.23.1.css' %}"
    />
{% endblock %}
{% block head %}
    <style>
        .toast:not(.show) {
            display: block;
        }
    </style>
    <link
        href="{% static 'css/client_portal/automated_search.css' %}"
        rel="stylesheet"
        type="text/css"
    />
    <link 
        type="text/css"
        rel="stylesheet"
        href="{% static 'css/client_portal/global.css' %}"
    />
{% endblock %}

{% block body %}
<div class="content__container" id="content">
    <div class="sub-navbar-home">
        <div class="sub-navbar-home-item-text">
            Create New Automated Search
        </div>
    </div>
        <div class="creation-automated-search-form">
            <div class="creation-automated-search-form-left">
                <!-- select device -->
                <div class="creation-form-item" style="display: flex;align-items: center">
                    <label for="text-input" class="creation-form-item-text">Select a Device:</label>
                    <select name="select-device" v-model="selectedDevice" :class="createDevice ? 'hidden-section creation-form-item-input' : 'displayed-section creation-form-item-input'">
                        <option value="">Select a device</option>
                        <option v-for="device in devices" :key="device.id" :value="device.id">[[device.device_name]]</option>
                    </select>
                    <div v-on:click="showCreateNewDeviceSection()" :class="createDevice ? 'displayed-section device-choice-select-btn' : 'hidden-section device-choice-select-btn'">
                        Select a Device
                    </div>
                </div>

                <!-- select Interval -->
                <div class="creation-form-item">
                    <label for="text-input" class="creation-form-item-text">Select a Interval:</label>
                    <select name="select-interval" v-model="selectedInterval" class="creation-form-item-input">
                        <option value="">Select a interval</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="annually">Annually</option>
                    </select>
                </div>
                
                <!-- select Database -->
                <div class="creation-form-item" style="display: block;">
                    <label for="text-input" class="creation-form-item-text" >Select Databases:</label>
                    <div class="create-db-selection-section">
                        <div class="creation-form-item-input-database">
                            <div v-if="selectedLitDbs.length > 0">
                                <h3 class="selected-db-header">Selected LIT Databases:</h3>
                                <ul>
                                  <li v-for="db in selectedLitDbs" :key="db" class="selected-db-text-list">[[db]]</li>
                                </ul>
                            </div>
                            <div v-if="selectedAEDbs.length > 0">
                                <h3 class="selected-db-header">Selected AE Databases:</h3>
                                <ul>
                                  <li v-for="db in selectedAEDbs" :key="db" class="selected-db-text-list">[[db]]</li>
                                </ul>
                            </div>
                            <div v-if="selectedExtraLicenseDbs.length > 0">
                                <h3 class="selected-db-header">Selected Extra License Databases:</h3>
                                <ul>
                                  <li v-for="db in selectedExtraLicenseDbs" :key="db" class="selected-db-text-list">[[db]]</li>
                                </ul>
                            </div>
                        </div>
                        <div v-on:click="showSelectDbsSection()" class="create-manufacturer-btn">
                            <img
                                src="{% static 'images/icons/add-icon.svg' %}"
                                alt=""
                                class="create-manufacturer-btn-icon"
                            />  
                        </div>
                    </div>
                    <div :class="selectDbsSection ? 'displayed-section' : 'hidden-section databases-choice-section'">
                        <div class="popup-database-selection">
                            <div class="popup-database-selection-popup">
                                <div class="header-popup-database-selection">
                                    <legend class="edit-adverse-event-header">
                                        Search Terms Databases
                                    </legend>
                                </div>
                                <!-- :checked="isDatabaseSelected(item.value, db)"  -->
                                <div class="body-popup-database-selection">
                                    <div class="database-selection-lit-dbs">
                                        <h2 class="database-selection-text-group">LIT Databases</h2>
                                        <div class="database-selection-lit-dbs-section">
                                            <label class="database-selection-container" v-for="db in lit_dbs" :key="db.entrez_enum">
                                                <input 
                                                    class="form-check-input" 
                                                    type="checkbox" 
                                                    name="db" 
                                                    :value="db.displayed_name" 
                                                    v-model="selectedLitDbs"
                                                >
                                                <div class="db-name-icon-section">
                                                    <img src="{% static 'assets/client_portal/img/db-icon.svg' %}" class="db-icon-selection">
                                                    [[db.displayed_name]]
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="database-selection-ae-dbs">
                                        <h2 class="database-selection-text-group-bottom">AE Databases</h2>
                                        <div class="database-selection-lit-dbs-section">
                                            <label class="database-selection-container" v-for="db in ae_basic_dbs" :key="db.entrez_enum">
                                                <input 
                                                    class="form-check-input" 
                                                    type="checkbox" 
                                                    name="db" 
                                                    :value="db.displayed_name" 
                                                    v-model="selectedAEDbs"
                                                >
                                                <div class="db-name-icon-section">
                                                    <img src="{% static 'assets/client_portal/img/db-icon.svg' %}" class="db-icon-selection">
                                                    [[db.displayed_name]]
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="database-selection-ae-dbs">
                                        <h2 class="database-selection-text-group-bottom">
                                            Extra License Databases
                                            <br>
                                            <span class="database-selection-text-group-bottom-note">
                                                Please note that selecting databases from the Extra License category will result in an additional charge.
                                            </span>
                                        </h2>

                                        <div class="database-selection-lit-dbs-section">
                                            <label class="database-selection-container" v-for="db in ae_extra_dbs" :key="db.entrez_enum">
                                                <input 
                                                    class="form-check-input" 
                                                    type="checkbox" 
                                                    name="db" 
                                                    :value="db.displayed_name" 
                                                    v-model="selectedExtraLicenseDbs"
                                                >
                                                <div class="db-name-icon-section">
                                                    <img src="{% static 'assets/client_portal/img/db-icon.svg' %}" class="db-icon-selection">
                                                    [[db.displayed_name]]
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="create-search-btns-section">
                                    <button class="btn cancel-btn" v-on:click="showSelectDbsSection()" type="button"> Close </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>


                <!-- select search type -->
                <div class="creation-form-item">
                    <label for="text-input" class="creation-form-item-text">Select a Search Type:</label>
                    <select name="select-interval" v-model="searchType" class="creation-form-item-input">
                        <option value="">Select Search Type</option>
                        <option value="terms">Terms</option>
                        <option value="file">File</option>
                    </select>
                </div>
                <!-- search Term -->
                <div v-if="searchType === 'terms'" class="creation-form-item">
                    <label for="text-input" class="creation-form-item-text">Search Text:</label>
                    <input type="text" id="text-input" v-model="searchTerms" class="creation-form-item-input">
                </div>
                <div v-else class="creation-form-item">
                    <label for="file-input" class="creation-form-item-text">Search File:</label>
                    <div>
                        <div :class="selectedFile ? 'displayed-section selected-file' : 'hidden-section selected-file'">
                            <span class="selected-file-span">Selected File: </span> 
                            <a class="project-table-body-action-link" :href="searchFile" target="_blank"> 
                                <img
                                src="{% static 'images/icons/file-icon.svg' %}"
                                alt=""
                                class="project-table-body-action-icon"
                                />   
                            </a>
                        </div>
                        <input type="file" id="file-input" @change="handleFileChange" class="creation-form-item-input">
                    </div>

                </div>
                <div class="creation-automated-search-form-submit-btn" id="creation-automated-search-form-submit-btn" v-on:click="validateNewAutomatedSearch()">
                    Update Search
                </div>
            </div>

            <div class="creation-automated-search-form-right">
                <div :class="createDevice ? 'hidden-section' : 'displayed-section device-choice-section'">
                    <span class="device-choice-text">Or</span>
                    <div v-on:click="showCreateNewDeviceSection()" class="device-choice-btn">
                        create new device
                    </div>
                </div>
                <div :class="createDevice ? 'displayed-section' : 'hidden-section'">
                    <!-- device name -->
                    <div class="creation-form-item">
                        <label for="text-input" class="creation-form-item-text">Device Name:</label>
                        <input type="text" id="text-input" class="creation-form-item-input" v-model="deviceName">
                    </div>
                    <!-- manufacturer name -->
                    <div :class="createManufacturer ? 'hidden-section' : 'displayed-section creation-form-item-manufacturer '">
                        <label for="text-input" class="creation-form-item-text" style="width: 31%;margin-bottom: 0px;">Select Manufacturer:</label>
                        <div class="create-manufacturer-section">
                            <select name="select-manufacture" v-model="selectedManufacturer" class="creation-form-item-input-manufacturer">
                                <option value="">Select a Manufacturer</option>
                                <option v-for="manufacturer in manufacturers" :key="manufacturer.name" :value="manufacturer.name">[[manufacturer.name]]</option>
                            </select>
                            
                            <div v-on:click="showCreateNewManufacturerSection()" class="create-manufacturer-btn">
                                <img
                                    src="{% static 'images/icons/add-icon.svg' %}"
                                    alt=""
                                    class="create-manufacturer-btn-icon"
                                />  
                            </div>
                        </div>
                    </div>
                    <div :class="createManufacturer ? 'displayed-section creation-form-item-manufacturer' : 'hidden-section'">
                        <label for="text-input" class="creation-form-item-text" style="width: 31%;margin-bottom: 0px;">Manufacturer Name:</label>
                        <div class="create-manufacturer-section">
                            <input type="text" id="text-input" v-model="manufacturerName" class="creation-form-item-input-manufacturer">
                            <div v-on:click="showCreateNewManufacturerSection()" class="create-manufacturer-btn">
                                <img
                                    src="{% static 'images/icons/add-icon.svg' %}"
                                    alt=""
                                    class="create-manufacturer-btn-icon"
                                />  
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Classification  -->
                    <div class="creation-form-item">
                        <label for="text-input" class="creation-form-item-text">Classification:</label>
                        <input type="text" id="text-input" v-model="classification" class="creation-form-item-input">
                    </div>
                    <!-- Markets  -->
                    <div class="creation-form-item">
                        <label for="text-input" class="creation-form-item-text">Markets:</label>
                        <input type="text" id="text-input" v-model="markets" class="creation-form-item-input">
                    </div>
                </div>
            </div>
        </div>
        <div class="creation-automated-search-form-submit">
        </div>
</div>

{% endblock %}

{% block script %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js" integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    const CreateAutomatedSearchURL = "{% url 'client_portal:create_automated_search_api' %}";
    const UpdateAutomatedSearchURL = "{% url 'client_portal:update_automated_search_api' search_id=automated_search.id %}";
</script>

{% if env == 'PROD' %}
<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.7.0"></script>
{% else %}
<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.7.0/dist/vue.js"></script>
{% endif %}

<script src="{% static 'vue-cdn/propper-2.11.8.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/portal-vue@2.1.7/dist/portal-vue.umd.min.js"></script>
<script src="{% static 'vue-cdn/bootstrap-vue-2.23.1.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vuejs-datepicker/1.6.2/vuejs-datepicker.min.js" integrity="sha512-SxUBqfNhPSntua7WUkt171HWx4SV4xoRm14vLNsdDR/kQiMn8iMUeopr8VahPpuvRjQKeOiMJTJFH5NHzNUHYQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="{% static 'client_portal/vue/update_automated_search.js' %}" > </script>

{% endblock %}